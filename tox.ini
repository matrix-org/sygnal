[tox]
envlist = py37, check_isort, check_codestyle, check_types

[testenv]

# As of twisted 16.4, trial tries to import the tests as a package (previously
# it loaded the files explicitly), which means they need to be on the
# pythonpath. Our sdist doesn't include the 'tests' package, so normally it
# doesn't work within the tox virtualenv.
#
# As a workaround, we tell tox to do install with 'pip -e', which just
# creates a symlink to the project directory instead of unpacking the sdist.
#
# (An alternative to this would be to set PYTHONPATH to include the project
# directory. Note two problems with this:
#
#   - if you set it via `setenv`, then it is also set during the 'install'
#     phase, which inhibits unpacking the sdist, so the virtualenv isn't
#     useful for anything else without setting PYTHONPATH similarly.
#
#   - `synapse` is also loaded from PYTHONPATH so even if you only set
#     PYTHONPATH for the test phase, we're still running the tests against
#     the working copy rather than the contents of the sdist. So frankly
#     you might as well use -e in the first place.
#
# )
usedevelop=true

commands = trial tests

[testenv:check_isort]
skip_install = True
deps = isort~=5.0
commands = /bin/sh -c "isort --check-only --diff ."

[testenv:check_codestyle]
skip_install = True
deps = flake8
commands = /bin/sh -c "flake8 ."

[testenv:check_types]
skip_install = True
deps = isort~=5.0
commands = /bin/sh -c "isort --check-only --diff ."
