name: CI-Checks
on: [push]
jobs: 
  check-code-style:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.7'
      - run: python -m pip install tox
      - run: tox -e check_codestyle
  
  check-types-mypy:
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.7'
      - run: python -m pip install tox  
      - run: tox -e check_types

  run-unit-tests-sqlite:
    needs: [check-code-style, check-types-(:mypy:)]
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.7'
      - run: python -m pip install -e .
      - run: trial tests
  
  # run-unit-tests-(on :postgres:):
  #   needs: [run-unit-tests-(on SQlite)]
  # runs-on: ubuntu-latest
  # container:  
  
  # steps:
  #   - uses: actions/checkout@v2
  #   - uses: actions/setup-python@v2
  #     with:
  #       python-version: '3.7'
  #   - uses: actions/ 
  # # - command:
  #     - "python -m pip install -e ."
  #     - "trial tests"
  #   label: "Run unit tests (on :postgres:)"
  #   plugins:
  #     - matrix-org/download#v1.1.0:
  #         urls:
  #           - https://raw.githubusercontent.com/matrix-org/pipelines/master/sygnal/docker-compose.yml
  #     - docker-compose#v3.2.0:
  #         run: testenv
  #         config:
  #           - /tmp/download-${BUILDKITE_BUILD_ID}/docker-compose.yml