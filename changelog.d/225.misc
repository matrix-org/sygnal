Improve static type checking. Contributed by Omar Mohamed.